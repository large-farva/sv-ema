//@version=5
indicator("Triple EMA (3-in-1) with Alerts", shorttitle="3xEMA+", overlay=true)

// ─── User Inputs ───
ema1_length = input.int(9, "EMA 1 Length", minval=1)
ema1_color  = input.color(color.new(color.teal, 0), "EMA 1 Color")

ema2_length = input.int(21, "EMA 2 Length", minval=1)
ema2_color  = input.color(color.new(color.orange, 0), "EMA 2 Color")

ema3_length = input.int(50, "EMA 3 Length", minval=1)
ema3_color  = input.color(color.new(color.purple, 0), "EMA 3 Color")

src = input.source(close, "Source")
show_labels = input.bool(true, "Show Trend Labels", tooltip="Toggle trend labels for crossover signals")

// ─── EMA Calculations ───
ema1 = ta.ema(src, ema1_length)
ema2 = ta.ema(src, ema2_length)
ema3 = ta.ema(src, ema3_length)

// ─── Plot the EMAs ───
plot(ema1, color=ema1_color, linewidth=2, title="EMA 1")
plot(ema2, color=ema2_color, linewidth=2, title="EMA 2")
plot(ema3, color=ema3_color, linewidth=2, title="EMA 3")

// ─── Determine Trend Direction ───
bullish = ema1 > ema2 and ema2 > ema3
bearish = ema1 < ema2 and ema2 < ema3

bgcolor(bullish ? color.new(color.green, 90) : bearish ? color.new(color.red, 90) : na, title="Trend Background")

// ─── EMA Cross Alerts ───
ema1_cross_ema2_up = ta.crossover(ema1, ema2)
ema1_cross_ema2_down = ta.crossunder(ema1, ema2)

ema2_cross_ema3_up = ta.crossover(ema2, ema3)
ema2_cross_ema3_down = ta.crossunder(ema2, ema3)

// ─── Alert Conditions ───
alertcondition(ema1_cross_ema2_up, title="EMA1 crosses above EMA2", message="EMA1 crossed above EMA2 – possible bullish signal")
alertcondition(ema1_cross_ema2_down, title="EMA1 crosses below EMA2", message="EMA1 crossed below EMA2 – possible bearish signal")
alertcondition(ema2_cross_ema3_up, title="EMA2 crosses above EMA3", message="EMA2 crossed above EMA3 – possible bullish continuation")
alertcondition(ema2_cross_ema3_down, title="EMA2 crosses below EMA3", message="EMA2 crossed below EMA3 – possible bearish continuation")

// ─── Optional Labels ───
if show_labels
    if ema1_cross_ema2_up
        label.new(bar_index, ema1, "EMA1↑EMA2", style=label.style_label_up, color=color.new(color.green, 0), textcolor=color.white)
    if ema1_cross_ema2_down
        label.new(bar_index, ema1, "EMA1↓EMA2", style=label.style_label_down, color=color.new(color.red, 0), textcolor=color.white)
    if ema2_cross_ema3_up
        label.new(bar_index, ema2, "EMA2↑EMA3", style=label.style_label_up, color=color.new(color.lime, 20), textcolor=color.white)
    if ema2_cross_ema3_down
        label.new(bar_index, ema2, "EMA2↓EMA3", style=label.style_label_down, color=color.new(color.maroon, 20), textcolor=color.white)

// ─── Display Trend Text ───
var label trend_label = na
if barstate.islast
    label.delete(trend_label)
    trend_text = bullish ? "Bullish Trend" : bearish ? "Bearish Trend" : "Neutral"
    trend_color = bullish ? color.new(color.green, 0) : bearish ? color.new(color.red, 0) : color.new(color.gray, 0)
    trend_label := label.new(bar_index, na, trend_text, style=label.style_label_left, color=trend_color, textcolor=color.white, yloc=yloc.price, xloc=xloc.bar_time)
